# Bookersについて
ウェブアプリケーション「Bookers」は、本のタイトルとその感想を投稿できるものである。感想は、新規作成、編集、削除を行うことができる。

# 外部仕様

Bookersでは、以下のようなことが行える。
* 読んだ本のタイトルと感想の投稿(New Bookのフォームより投稿)
* 投稿された感想の閲覧(一覧ページのShowリンクをクリックすることにより閲覧ページへジャンプ)
* 投稿された感想の編集(一覧ページのEditリンクをクリックすることにより編集ページへジャンプ)
* 投稿された感想の削除(一覧ページのDestroyリンクをクリックすることにより感想を削除)

なお、新規投稿・編集・削除が成功した場合にはサクセスメッセージが表示される。
また、投稿および編集時、タイトルと本文のいずれかもしくは両方が空白であった場合、エラーメッセージが表示される。


# 内部仕様
Ruby on Railsを使用した、MVCモデルのアプリケーションになっている。

## M(モデル)
本のタイトルと感想を管理するモデルBookを作成した。カラムはtitle（本のタイトル）、body（感想）の2項目である。
どちらもstring型を採用している。

## C（コントローラー）
トップページを管理するhomes_controllerと、投稿一覧と投稿フォームを管理するbooks_controllerを作成した。

### homes_controller
トップページに関するコントローラー。トップページを表示するアクションtopのみが存在している。
topアクションでは特に何も行わない。


### books_controller
投稿一覧画面など、トップページ以外での動きに関するコントローラー。
RESTfulなアクションのうち、new以外のすべてが定義されている。
newが定義されていないのは、新規作成画面と投稿一覧画面が同じなため、
今までnewで書いていた新規作成のための処理を、indexの中にまとめたからである。


各アクションの簡単な内容を以下に示す。
#### index
投稿一覧及び新規作成画面(index.html.erb)を表示するためのアクション。
ビューで表示するためのインスタンス編すを各種定義している。
新規作成のために必要なインスタンス変数も同時に生成していることに注意。
新規作成と投稿一覧表示を同じページ内で実装したことにより、
ルーティングの順番的にindexしか呼び出されなくなったためこのようなコーディングになっている。

#### create
新規作成が行われた時に、その内容を保存するアクション。
```if book.save```以下で保存に成功した場合と失敗した場合の処理を分岐して記述している。


成功した場合は、入力内容を保存してサクセスメッセージを表示し、
失敗した場合は、renderで指定されたページを表示する。
このとき、redirect_toと違ってrenderではページをリロードしないため、発声したエラーが保持される。
その結果、renderでアクセスしなおすとエラーメッセージが表示される。


また、このアクションでは成功時にはインスタンス変数は必要ないため、
はじめはローカル変数に必要なデータを格納しているが、失敗した場合はページを表示する際に
ビューへと受け渡せるインスタンス変数が必要となるため、インスタンス変数に格納しなおしている。


#### show
各投稿の詳細ページを表示するアクション。indexで表示したページにあるshowリンクを押すと、このアクションが実行される。
このアクションでインスタンス変数を作成して、その内容をビューに渡す。

#### edit
各投稿の編集ページを表示するアクション。indexで表示したページにあるEditリンクを押すと、このアクションが実行される。
このアクションでインスタンス変数を作成して、その内容をビューに渡す。

#### update
編集フォームで入力された内容をデータベースに保存するアクション。createメソッドと同様の分岐処理を施している。

#### destroy
各投稿を削除するときに実行するアクション。一覧ページのDestroyリンクをクリックすると実行される。
ここでもcreate, editと同じような成功・失敗時の分岐処理がなされている。



## V（ビュー）
homes, books各コントローラーに対応するビューを指定するファイル群である。
ファイルごとに注目すべき工夫点を列挙しておく。

### /homesディレクトリ
トップページに関する記述top.html.erbが存在するディレクトリ。
逆に、top.html.erb以外存在していない。
メッセージと、Bookersの感想一覧表示ページへのリンクが存在している。
見本のトップページ（https://bookers-level1.herokuapp.com/）とある程度同じレイアウトにしている
（が、完ぺきではない）。

### /booksディレクトリ
投稿一覧、新規作成、編集、削除などのアクションに関するビューが存在するディレクトリ。

#### index.html.erb
投稿一覧の表示および新規作成フォームが存在するページのビュー。
create, destroyのエラーメッセージ、destroyのサクセスメッセージもこのページに表示される。
一覧表示はtable要素で表形式で表示する。
投稿内容が長すぎる場合は、「...」を用いて省略表示する。
新規投稿フォームはform_withを用いて実装する。

#### show.html.erb
各投稿の詳細を表示するページ。
create, updateアクションが成功した場合のサクセスメッセージもここで表示。
タイトル・感想、さらに編集ページへのリンクEditと一覧ページへのリンクBackが存在している。

#### edit.html.erb
各投稿の編集フォームページ。
updateアクション失敗時のエラーメッセージはここで表示される。
編集フォームと、詳細ページへのリンク、一覧ページへのリンクが存在している。



### /layoutsディレクトリ
各ページ共通のレイアウトに関するhtmlが保存されている。

#### application.html.erb
全てのビューページに共通する内容が書かれている。
ここではhead要素の宣言などを行い、具体的なレイアウトについては何も示していない。

#### _error_messages.html.erb
エラーメッセージに関する部分テンプレートである。
部分テンプレートであるため、ファイル名の最初に「_」(アンダーバー)が入っている。
エラー文の1行目には、いくつエラーが発生しているかを書き、
2行目以降にはエラー文本体を箇条書き形式で表示する。

ちなみに、このテンプレートはビューファイルの適切な位置で
renderメソッドを使用して呼び出す。



### その他
#### app/assets/stylesheets/application.css
上記で示したすべての.html.erbについてのレイアウトを指定するcssファイル。





# ほかに特筆すべきファイル
ここでは、上記には記していないがアプリケーションを作成するうえで自分で変更したふぁいるについて、その変更内容を上げておく。

## config/routes.rb
ルーティングを示したファイル。
特にboks_controllerについてのルーティングはresourcesメソッドを用いている。

## app/model/book.rb
バリデーションを指定するファイル。指定にはvalidateメソッドを使用した。

## Gemfile
利用したgemの一覧を記載しているファイル。



